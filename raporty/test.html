<!DOCTYPE html>
<html>
<head>
    <title>TEST</title>
</head>
<body>

    <input type="file" id="file-input" />
    <button id="download-btn" style="display: none;">Pobierz JSON</button>
    <pre id="json-display"></pre>

    <script>
		var jsonContent;
	
        document.getElementById("file-input").addEventListener("change", function(event) {
            var file = event.target.files[0];
            var reader = new FileReader();

            reader.onload = function(e) {
                var fileContent = e.target.result;
                var lines = fileContent.split("\n").slice(1); // Omit 1st line

                var reportData = {
                    start_time: lines[0].trim(),
                    date: lines[1].trim(),
                    instructor: lines[2].trim(),
                    course: lines[3].trim(),
                    total_points: parseInt(lines[4].trim()),
                    change_in_points: parseInt(lines[5].trim()),
                    opinions: []
                };

                var opinion = "";
                var inOpinion = false;

                lines.slice(6).forEach(function(line) {
                    line = line.trim();
                    if (line.startsWith("{")) {
                        opinion = line;
                        inOpinion = true;
                    } else if (line.endsWith("}")) {
                        opinion += " " + line;
                        reportData.opinions.push(opinion.slice(1, -1).trim());
                        inOpinion = false;
                    } else if (inOpinion) {
                        opinion += " " + line;
                    }
                });

                jsonContent = JSON.stringify(reportData, null, 2);
                document.getElementById("json-display").textContent = jsonContent;
                document.getElementById("download-btn").style.display = 'inline';
            };

            reader.readAsText(file);
        });

        document.getElementById("download-btn").addEventListener("click", function() {
            var fileName = "raport.json";
            var element = document.createElement('a');
            element.setAttribute('href', 'data:application/json;charset=utf-8,' + encodeURIComponent(jsonContent));
            element.setAttribute('download', fileName);

            element.style.display = 'none';
            document.body.appendChild(element);
            element.click();
            document.body.removeChild(element);
        });
    </script>

</body>
</html>
